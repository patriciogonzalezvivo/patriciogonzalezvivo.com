

<html>
<head>
	<title>Lion</title>
	<style>canvas { width: 100%; height: 100% }</style>
</head>
<body style="margin: 0; padding: 0">

	<style type="text/css">
	
	.info{
		color:white;
		font-weight: bold;
		text-shadow:  1px  1px 1px black,
					  1px -1px 1px black,
					 -1px  1px 1px black,
					 -1px -1px 1px black;
	}
	
	a:hover, a:visited, a:link, a:active{
		color: #ccccff;
		text-decoration: none;
	}

	body {
		background-color: #FFFFFF;
	}
	
	</style>

	<script src="/js/libs/three.js"></script>
	<script src="/js/libs/OrbitControls.js"></script>
	<script src="/js/libs/stats.min.js"></script>
	<script src="/js/libs/dat.gui.min.js"></script>
	<script src="/js/libs/dat.gui.min.js"></script>
	<script src="/js/libs/potree.min.js"></script>

	<script>
		var defaultPointSize = 0.67;
		var defaultLOD = 10;
		var pointcloudPath = "cloud.js";
	
		var renderer;
		var camera;
		var scene;
		var pointclouds = [];
		var stats;
		var pointcloudMaterial;
		
		function initGUI(){
			var gui = new dat.GUI({
				height : 5 * 32 - 1
			});
			
			var params = {
				PointSize: defaultPointSize,
				LOD: defaultLOD
			};
			
			var pLOD = gui.add(params, 'LOD', 0.5,10);
			pLOD.onChange(function(value){
				//pointCloud.LOD = value;
				for(var i = 0; i < pointclouds.length; i++){
					pointclouds[i].LOD = value;
				}
			});
			
			var pPointSize = gui.add(params, 'PointSize', 0.1, 3.0);
			pPointSize.onChange(function(value){
				pointcloudMaterial.size = value;
			});
		}
		
		function initThree(){
			stats = new Stats();
			stats.domElement.style.position = 'absolute';
			stats.domElement.style.top = '0px';
			stats.domElement.style.margin = '5px';
			document.body.appendChild( stats.domElement );
		
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 10000);

			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.autoClear = false;
			renderer.setClearColor(0xffffff, 1);
			document.body.appendChild(renderer.domElement);
		
			// camera and controls
			camera.position.set(100,240,238);
			controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.target.set( 100, 3, -200 );
			camera.lookAt(controls.target);
			
			pointcloudMaterial = new THREE.PointCloudMaterial( { size: defaultPointSize, vertexColors: true } );
			
			//// load pointcloud
			var pco = POCLoader.load(pointcloudPath);

			var pointcloud = new Potree.PointCloudOctree(pco, pointcloudMaterial);
			pointcloud.LOD = defaultLOD;
			pointcloud.rotation.set(Math.PI*1.5,0,0);
			pointcloud.moveToOrigin();
					
			pointclouds.push(pointcloud);
			scene.add(pointcloud);
		}
		
		function render() {
					
			requestAnimationFrame(render);
			
			var numVisibleNodes = 0;
			var numVisiblePoints = 0;
			for(var i = 0; i < pointclouds.length; i++){
				var pointcloud = pointclouds[i];
				pointcloud.update(camera);
				numVisibleNodes += pointcloud.numVisibleNodes;
				numVisiblePoints += pointcloud.numVisiblePoints;
			}
			
			renderer.render(scene, camera);
			
			stats.update();
			controls.update(0.1);
			
		};
		
		initThree();
		initGUI();
		render();
		
	</script>
	
</body>
</html>